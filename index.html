<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªå­¸ç¿’å°ç«™ - å¯æ„›ç‰ˆ</title>
    <style>
        :root {
            /* å¯æ„›ç²‰å«©è‰²ç³» */
            --primary-color: #FF80AB;   /* ç²‰ç´… */
            --secondary-color: #4DD0E1; /* ç²‰è— */
            --accent-color: #FFD54F;    /* éµé»ƒ */
            --button-text: #fff;
            --text-color: #5d4037;      /* æ·±å’–å•¡è‰²æ–‡å­—ï¼Œæ¯”é»‘è‰²æŸ”å’Œ */
            --card-bg: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Microsoft JhengHei', sans-serif; /* å˜—è©¦ä½¿ç”¨åœ“é«”/æ‰‹å¯«é«” */
            background-color: #FFDEE9;
            background-image: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-attachment: fixed; /* èƒŒæ™¯å›ºå®šï¼Œæ»‘å‹•æ™‚ä¸è·Ÿè‘—å‹• */
        }

        h1 {
            color: #ec407a;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 0px #fff;
            font-size: 2.5rem;
        }

        .menu-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
            max-width: 800px;
        }

        .btn {
            padding: 15px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 25px; /* åœ“æ»¾æ»¾çš„æŒ‰éˆ• */
            cursor: pointer;
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-family: inherit;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* å„ç¨®æŒ‰éˆ•é¡è‰² */
        .btn-flash { background-color: #4DB6AC; } /* ç¶ æ¾çŸ³ */
        .btn-vocab-ec { background-color: #FF8A65; } /* çŠç‘šç´… */
        .btn-vocab-ce { background-color: #9575CD; } /* ç´«è‰² */
        .btn-grammar { background-color: #64B5F6; } /* è—è‰² */
        .btn-home { background-color: #90A4AE; margin-top: 20px; }
        .next-btn { background-color: #F06292; color: white; display: none; margin-top: 20px; }

        .section {
            display: none;
            width: 90%;
            max-width: 600px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 30px; /* å¤§åœ“è§’å¡ç‰‡ */
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.5);
            animation: popIn 0.5s;
            border: 4px solid #fff;
        }

        .active { display: block; }

        /* é–ƒå¡æ¨£å¼ */
        .flashcard-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
        }

        .flashcard {
            background: #fff;
            border: 3px solid #E0F7FA;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .flashcard:hover {
            border-color: var(--primary-color);
            transform: scale(1.08) rotate(-2deg); /* æ‡¸åœæ™‚ç¨å¾®æ­ªä¸€é»ï¼Œæ¯”è¼ƒå¯æ„› */
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .word-en { font-size: 1.1em; font-weight: bold; color: #ec407a; margin-bottom: 5px; }
        .word-zh { font-size: 0.9em; color: #78909c; }

        /* æ¸¬é©—æ¨£å¼ */
        .quiz-container { text-align: center; }
        
        .question-box {
            font-size: 1.6em;
            margin-bottom: 25px;
            font-weight: bold;
            color: #5d4037;
            background-color: #FFF9C4; /* æ·ºé»ƒè‰²èƒŒæ™¯ */
            padding: 20px;
            border-radius: 20px;
            border: 3px dashed #FBC02D; /* è™›ç·šé‚Šæ¡† */
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background-color: #fff;
            border: 2px solid #eee;
            color: #555;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .option-btn:hover {
            background-color: #E1BEE7;
            border-color: #BA68C8;
            color: white;
        }
        
        .correct { background-color: #C8E6C9 !important; border-color: #43A047 !important; color: #1B5E20 !important; }
        .wrong { background-color: #FFCDD2 !important; border-color: #E53935 !important; color: #B71C1C !important; }

        .feedback-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
            height: 60px;
            animation: bounce 0.5s;
        }
        
        .score-board {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #888;
            background: #fff;
            display: inline-block;
            padding: 5px 20px;
            border-radius: 50px;
        }

        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

        /* RWD */
        @media (max-width: 500px) {
            .options-grid { grid-template-columns: 1fr; }
            h1 { font-size: 2rem; }
            .menu-container { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

    <h1>ğŸˆ è‹±èªå¿«æ¨‚å­¸ ğŸˆ</h1>

    <div id="main-menu" class="menu-container">
        <button class="btn btn-flash" onclick="showSection('flashcards')">
            ğŸ“– å–®å­—é–ƒå¡
        </button>
        <button class="btn btn-vocab-ec" onclick="startVocabQuiz('en_to_zh')">
            ğŸ‡ºğŸ‡¸â¡ğŸ‡¹ğŸ‡¼ çœ‹è‹±æ–‡é¸ä¸­æ–‡
        </button>
        <button class="btn btn-vocab-ce" onclick="startVocabQuiz('zh_to_en')">
            ğŸ‡¹ğŸ‡¼â¡ğŸ‡ºğŸ‡¸ çœ‹ä¸­æ–‡é¸è‹±æ–‡
        </button>
        <button class="btn btn-grammar" onclick="startGrammarQuiz()">
            ğŸ’° èªæ³•èˆ‡åƒ¹æ ¼æ¸¬é©—
        </button>
    </div>

    <div id="flashcards" class="section">
        <h2 style="text-align: center; color: #4DB6AC;">âœ¨ é»æ“Šå–®å­—è½ç™¼éŸ³ âœ¨</h2>
        <div class="flashcard-container" id="flashcard-list">
            </div>
        <div style="text-align: center;">
            <button class="btn btn-home" onclick="showSection('main-menu')">ğŸ  å›é¦–é </button>
        </div>
    </div>

    <div id="quiz-area" class="section">
        <div style="text-align: center;">
            <div class="score-board">â­ å¾—åˆ†: <span id="current-score">0</span> / <span id="total-questions">0</span></div>
            <div class="feedback-icon" id="feedback-icon"></div>
        </div>
        
        <div class="question-box" id="question-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
        
        <div class="options-grid" id="options-area">
            </div>
        
        <div style="text-align: center;">
            <button class="btn next-btn" id="next-btn" onclick="nextQuestion()">â¡ ä¸‹ä¸€é¡Œ</button>
            <button class="btn btn-home" id="quit-btn" onclick="showSection('main-menu')">ğŸšª çµæŸæ¸¬é©—</button>
        </div>
    </div>

    <script>
        // --- 1. è³‡æ–™åº« (åœ–ç‰‡ä¸­çš„å–®å­—) ---
        const vocabulary = [
            // Image 1
            { en: 'eggs', zh: 'é›è›‹ (è¤‡æ•¸)', type: 'plural' },
            { en: 'oranges', zh: 'æŸ³æ©™ (è¤‡æ•¸)', type: 'plural' },
            { en: 'strawberries', zh: 'è‰è“ (è¤‡æ•¸)', type: 'plural' },
            { en: 'watermelons', zh: 'è¥¿ç“œ (è¤‡æ•¸)', type: 'plural' },
            { en: 'cookies', zh: 'é¤…ä¹¾ (è¤‡æ•¸)', type: 'plural' },
            { en: 'hamburgers', zh: 'æ¼¢å ¡ (è¤‡æ•¸)', type: 'plural' },
            { en: 'hot dogs', zh: 'ç†±ç‹— (è¤‡æ•¸)', type: 'plural' },
            // Image 2
            { en: 'sandwiches', zh: 'ä¸‰æ˜æ²» (è¤‡æ•¸)', type: 'plural' },
            { en: 'how many', zh: 'å¹¾å€‹', type: 'grammar' },
            { en: 'need', zh: 'éœ€è¦', type: 'verb' },
            { en: 'how much', zh: 'å¤šå°‘éŒ¢', type: 'grammar' },
            { en: 'dollar', zh: 'å…ƒ (è²¨å¹£å–®ä½)', type: 'noun' },
            { en: 'hundred', zh: 'ç™¾ (æ•¸å­—)', type: 'number' },
            // Image 3
            { en: 'dinner', zh: 'æ™šé¤', type: 'uncountable' },
            { en: 'bread', zh: 'éºµåŒ…', type: 'uncountable' },
            { en: 'chicken', zh: 'é›è‚‰', type: 'uncountable' },
            { en: 'would like', zh: 'æƒ³è¦', type: 'verb' },
            // Image 4
            { en: 'breakfast', zh: 'æ—©é¤', type: 'uncountable' },
            { en: 'rice', zh: 'ç±³é£¯', type: 'uncountable' },
            { en: 'soup', zh: 'æ¹¯', type: 'uncountable' },
            { en: 'lunch', zh: 'åˆé¤', type: 'uncountable' },
            { en: 'noodles', zh: 'éºµ', type: 'plural' }
        ];

        // --- 2. ç‹€æ…‹è®Šæ•¸ ---
        let currentMode = ''; // 'vocab' or 'grammar'
        let vocabDirection = ''; // 'en_to_zh' or 'zh_to_en'
        let currentScore = 0;
        let questionCount = 0;
        let isAnswered = false;

        // --- 3. éŸ³æ•ˆ (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'correct') { // è¼•å¿«çš„é«˜éŸ³
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(659.25, audioCtx.currentTime); // E5
                osc.frequency.setValueAtTime(880, audioCtx.currentTime + 0.1); // A5
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else { // æŸ”å’Œçš„ä½éŸ³
                osc.type = 'sine';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function speakWord(text) {
            // åªæœ‰è‹±æ–‡æ‰ç™¼éŸ³
            if (/^[a-zA-Z\s]+$/.test(text)) {
                const msg = new SpeechSynthesisUtterance();
                msg.text = text;
                msg.lang = 'en-US';
                window.speechSynthesis.speak(msg);
            }
        }

        // --- 4. ä»‹é¢æ§åˆ¶ ---
        function showSection(id) {
            document.getElementById('main-menu').style.display = (id === 'main-menu') ? 'flex' : 'none';
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            if (id !== 'main-menu') document.getElementById(id).classList.add('active');
            if (id === 'flashcards') initFlashcards();
        }

        function initFlashcards() {
            const container = document.getElementById('flashcard-list');
            container.innerHTML = '';
            vocabulary.forEach(word => {
                const card = document.createElement('div');
                card.className = 'flashcard';
                card.innerHTML = `<div class="word-en">${word.en}</div><div class="word-zh">${word.zh}</div>`;
                card.onclick = () => speakWord(word.en);
                container.appendChild(card);
            });
        }

        // --- 5. æ¸¬é©—æ ¸å¿ƒ ---
        function resetQuizState(mode) {
            currentMode = mode;
            currentScore = 0;
            questionCount = 0;
            document.getElementById('current-score').textContent = 0;
            document.getElementById('total-questions').textContent = 0;
            document.getElementById('quit-btn').style.display = 'inline-block';
            nextQuestion();
        }

        function nextQuestion() {
            isAnswered = false;
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('feedback-icon').textContent = '';
            
            if (currentMode === 'vocab') generateVocabQuestion();
            else generateGrammarQuestion();
        }

        function handleAnswer(btn, isCorrect, correctText) {
            if (isAnswered) return;
            isAnswered = true;
            questionCount++;
            document.getElementById('total-questions').textContent = questionCount;
            
            const options = document.querySelectorAll('.option-btn');
            options.forEach(b => b.disabled = true);

            const feedback = document.getElementById('feedback-icon');

            if (isCorrect) {
                currentScore++;
                document.getElementById('current-score').textContent = currentScore;
                btn.classList.add('correct');
                feedback.innerHTML = 'ğŸ‰';
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                feedback.innerHTML = 'ğŸ·'; // ç­”éŒ¯é¡¯ç¤ºå¯æ„›è±¬è±¬
                playSound('wrong');
                options.forEach(b => {
                    if (b.textContent === correctText) b.classList.add('correct');
                });
            }
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

        // --- 6. å–®å­—æ¸¬é©— (é›™æ¨¡å¼) ---
        function startVocabQuiz(direction) {
            vocabDirection = direction; // 'en_to_zh' or 'zh_to_en'
            showSection('quiz-area');
            resetQuizState('vocab');
        }

        function generateVocabQuestion() {
            const target = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            let question, correctAns, wrongPool;

            if (vocabDirection === 'en_to_zh') {
                // é¡Œç›®ï¼šè‹±æ–‡ï¼Œé¸é …ï¼šä¸­æ–‡
                question = target.en;
                correctAns = target.zh;
                wrongPool = vocabulary.filter(w => w.zh !== target.zh).map(w => w.zh);
                speakWord(target.en); // å”¸å‡ºé¡Œç›®
            } else {
                // é¡Œç›®ï¼šä¸­æ–‡ï¼Œé¸é …ï¼šè‹±æ–‡
                question = target.zh;
                correctAns = target.en;
                wrongPool = vocabulary.filter(w => w.en !== target.en).map(w => w.en);
            }

            document.getElementById('question-text').textContent = question;
            
            let options = [correctAns];
            options = options.concat(shuffle(wrongPool).slice(0, 3));
            options = shuffle(options);

            const area = document.getElementById('options-area');
            area.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => {
                    handleAnswer(btn, opt === correctAns, correctAns);
                    if (vocabDirection === 'zh_to_en') speakWord(opt); // é¸é …æ˜¯è‹±æ–‡æ™‚ï¼Œé»æ“Šç™¼éŸ³
                    else if (vocabDirection === 'en_to_zh' && opt === correctAns) speakWord(target.en); // ç­”å°æ™‚é‡å”¸
                };
                area.appendChild(btn);
            });
        }

        // --- 7. èªæ³•æ¸¬é©— ---
        function startGrammarQuiz() {
            showSection('quiz-area');
            resetQuizState('grammar');
        }

        function generateGrammarQuestion() {
            const type = Math.floor(Math.random() * 4);
            const plurals = vocabulary.filter(w => w.type === 'plural');
            const uncountables = vocabulary.filter(w => w.type === 'uncountable');
            const randPl = plurals[Math.floor(Math.random() * plurals.length)];
            const randUc = uncountables[Math.floor(Math.random() * uncountables.length)];

            let qText = "", ans = "", opts = [];

            switch(type) {
                case 0: // How many/much
                    if (Math.random() > 0.5) {
                        qText = `_______ ${randPl.en} do you need?`; ans = "How many";
                    } else {
                        qText = `_______ ${randUc.en} do you need?`; ans = "How much";
                    }
                    opts = ["How many", "How much", "What", "Who"];
                    break;
                case 1: // is/are
                    if (Math.random() > 0.5) {
                        qText = `How much _______ the ${randPl.en}?`; ans = "are";
                    } else {
                        qText = `How much _______ the ${randUc.en}?`; ans = "is";
                    }
                    opts = ["is", "are", "do", "does"];
                    break;
                case 2: // do/does
                    const subjs = [{s:"you",v:"do"}, {s:"he",v:"does"}, {s:"she",v:"does"}, {s:"Amy",v:"does"}];
                    const pick = subjs[Math.floor(Math.random()*subjs.length)];
                    qText = `_______ ${pick.s} want some ${randPl.en}?`;
                    ans = pick.v === "do" ? "Do" : "Does";
                    opts = ["Do", "Does", "Is", "Are"];
                    break;
                case 3: // Context
                    const tpls = [
                        {q: "I want one _______.", a: "hundred", o: ["hundred", "dollar", "much", "many"]},
                        {q: "The soup is 50 _______.", a: "dollars", o: ["dollars", "dollar", "price", "is"]}, // Trick: dollars
                        {q: "I eat _______ for lunch.", a: "noodles", o: ["noodles", "how many", "does", "dollar"]}
                    ];
                    const t = tpls[Math.floor(Math.random()*tpls.length)];
                    qText = t.q; ans = t.a; opts = t.o;
                    break;
            }

            if (!opts.includes(ans)) opts[0] = ans;
            opts = shuffle(opts);

            document.getElementById('question-text').textContent = qText;
            const area = document.getElementById('options-area');
            area.innerHTML = '';
            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => {
                    handleAnswer(btn, opt.toLowerCase() === ans.toLowerCase(), ans);
                    speakWord(opt);
                };
                area.appendChild(btn);
            });
        }
    </script>
</body>
</html>